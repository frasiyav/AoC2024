⟨ Split, lf ⟩ ← •Import "bqn-libs/strings.bqn"

m1‿moves ← (>lf Split⊢)¨ (lf∾lf) Split ¯1↓•file.Chars "input15.txt"

d ← ⌽[1‿0,¯1‿0,0‿1,0‿¯1]⊏˜"v^><"⊐⥊moves
m2 ← ∾˘⊏⟜["..","##","[]","@."]¨".#O@"⊐m1

P1 ← ⋈¨⊣/˜'O'=⊑
H ← ⋈¨⊣/˜"[]"∊˜⊑
V ← ⍷ ⊣(2⊸≠/⊣∧∘⋈¨⊣+⟨0‿1,0‿¯1,0‿0⟩⊏˜⊢)"[]"⊐⊑
R ← /○⥊⟜(↕≢) '@'=⊢
_P_ ← {𝕨{⌽⌾(𝕨⊸⊑)𝕩}˝⟜(⍉𝕩≍t)⍟(∧´'.'=t⊑⊣)˜𝕨𝕊˜´𝕨𝔾˜t←𝕩+⚇1𝕗}
GPS ← +´100‿1×·+´∘⥊=×·↕∘≢⊢

•Show 'O' GPS m1 {𝕩 𝕨_P_ p1 R𝕩}˝d
•Show '[' GPS m2 {𝕩 𝕨_P_(v‿h⊑˜0=⊑𝕨) R𝕩}˝d
